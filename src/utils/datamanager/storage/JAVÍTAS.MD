## üéØ **CACHE-FIRST STRAT√âGIA IMPLEMENT√ÅL√ÅSI TERV** üöÄ

Most **PONT ERRE KONCENTR√ÅLUNK** - a t√∂rzsm√≥d cache optimaliz√°l√°sra!

## üìã **IMPLEMENT√ÅL√ÅSI ROADMAP**

### **1. F√ÅZIS - FRONTLOCAL.TS CACHE IMPLEMENT√ÅL√ÅS** ‚ö°

```typescript
// HOZZ√ÅADAND√ì: Modul szint≈± cache (f√°jl tetej√©n)

interface CachedNewsData {
  news: APINewsItem[];
  timestamp: number;
  country: string;
  importanceLevel: number;
}

const frontLocalNewsCache = new Map<string, CachedNewsData>();
const TORZS_MODE_NEWS_TTL_MS = 4 * 60 * 60 * 1000; // 4 √≥ra

function getTorzsModeCacheKey(country: string, importanceLevel: number): string {
  return `torzs-${country.toLowerCase()}-${importanceLevel}`;
}
```

### **2. F√ÅZIS - GETNEWS F√úGGV√âNY CACHE LOGIKA** üîß

```typescript
// M√ìDOS√çTAND√ì: getNews f√ºggv√©ny eleje
static async getNews(filters: NewsFilters = {}): Promise<APINewsItem[]> {
  let allNewsItems: APINewsItem[] = [];
  let fetchedFromCache = false;

  // √öJ: Cache ellen≈ërz√©s t√∂rzsm√≥d eset√©n
  if (effectiveFilters.torzsMode) {
    const cacheKey = getTorzsModeCacheKey(
      effectiveFilters.country || 'Hungary',
      effectiveFilters.importanceLevel || 10
    );

    const cachedEntry = frontLocalNewsCache.get(cacheKey);
    if (cachedEntry && Date.now() - cachedEntry.timestamp < TORZS_MODE_NEWS_TTL_MS) {
      console.log(`[FrontLocal.getNews] üéØ T√ñRZS CACHE HIT! ${cachedEntry.news.length} h√≠r, kor: ${Math.round((Date.now() - cachedEntry.timestamp)/60000)}perc`);
      allNewsItems = cachedEntry.news;
      fetchedFromCache = true;
    }
  }

  // Felt√©teles API h√≠v√°s
  if (!fetchedFromCache) {
    // ...megl√©v≈ë API h√≠v√°s logika...
  }

  // Cache ment√©s sikeres API ut√°n
  if (effectiveFilters.torzsMode && !fetchedFromCache && allNewsItems.length > 0) {
    const cacheKey = getTorzsModeCacheKey(
      effectiveFilters.country || 'Hungary',
      effectiveFilters.importanceLevel || 10
    );

    frontLocalNewsCache.set(cacheKey, {
      news: allNewsItems,
      timestamp: Date.now(),
      country: effectiveFilters.country || 'Hungary',
      importanceLevel: effectiveFilters.importanceLevel || 10
    });

    console.log(`[FrontLocal.getNews] üíæ T√ñRZS CACHE MENT√âS: ${allNewsItems.length} h√≠r mentve`);
  }
}
```

### **3. F√ÅZIS - CACHE METRIK√ÅK √âS MONITORING** üìä

```typescript
// HOZZ√ÅADAND√ì: Cache statisztik√°k
interface CacheStats {
  hits: number;
  misses: number;
  saves: number;
  size: number;
  totalItems: number;
}

const cacheStats: CacheStats = {
  hits: 0,
  misses: 0,
  saves: 0,
  size: 0,
  totalItems: 0
};

// Statisztik√°k lek√©rdez√©se
static getCacheStats(): CacheStats {
  return {
    ...cacheStats,
    size: frontLocalNewsCache.size,
    totalItems: Array.from(frontLocalNewsCache.values())
      .reduce((sum, cache) => sum + cache.news.length, 0)
  };
}

// Cache tiszt√≠t√°s
static clearCache(country?: string): void {
  if (country) {
    const keysToDelete = Array.from(frontLocalNewsCache.keys())
      .filter(key => key.includes(country.toLowerCase()));
    keysToDelete.forEach(key => frontLocalNewsCache.delete(key));
  } else {
    frontLocalNewsCache.clear();
  }
  console.log(`[FrontLocal] Cache t√∂r√∂lve: ${country || '√∂sszes'}`);
}
```

### **4. F√ÅZIS - HIBAKEZEL√âS √âS STALE CACHE** üõ°Ô∏è

```typescript
// HOZZ√ÅADAND√ì: Hibakezel√©s cache fallback-kel
try {
  // API h√≠v√°s...
} catch (apiError) {
  console.error('[FrontLocal.getNews] API hiba:', apiError);

  // Stale cache pr√≥b√°lkoz√°s t√∂rzsm√≥d eset√©n
  if (effectiveFilters.torzsMode) {
    const cacheKey = getTorzsModeCacheKey(
      effectiveFilters.country || 'Hungary',
      effectiveFilters.importanceLevel || 10,
    );

    const staleCache = frontLocalNewsCache.get(cacheKey);
    if (staleCache) {
      console.warn(
        `[FrontLocal.getNews] ‚ö†Ô∏è STALE CACHE haszn√°lata API hiba miatt: ${staleCache.news.length} h√≠r`,
      );
      return staleCache.news;
    }
  }

  throw apiError;
}
```

## üìä **IMPLEMENT√ÅL√ÅSI PRIORIT√ÅSOK**

### **S√úRG≈êS (1 nap)** üî•

1. **Cache Map l√©trehoz√°s** - Alapstrukt√∫ra
2. **Cache ellen≈ërz√©s** - getNews m√≥dos√≠t√°s
3. **Cache ment√©s** - Sikeres API ut√°n
4. **Alapvet≈ë logol√°s** - Debug inform√°ci√≥k

### **FONTOS (3 nap)** ‚ö°

1. **Cache metrik√°k** - Teljes√≠tm√©nym√©r√©s
2. **Stale cache fallback** - Hibakezel√©s
3. **CacheÊ∏ÖÈô§** - Manual refresh opci√≥k
4. **TTL konfigur√°ci√≥** - Rugalmas id≈ëbe√°ll√≠t√°sok

### **HASZNOS (1 h√©t)** üìà

1. **useTabStorage integr√°ci√≥** - Perzisztens cache
2. **Background refresh** - Proakt√≠v friss√≠t√©s
3. **Cache warming** - El≈ët√∂lt√©s
4. **Teljes√≠tm√©ny dashboard** - Monitoring UI

## üéØ **TESZTEL√âSI TERV**

### **A. FUNKCION√ÅLIS TESZTEK** ‚úÖ

- T√∂rzsm√≥d els≈ë bet√∂lt√©s (cache miss)
- T√∂rzsm√≥d m√°sodik bet√∂lt√©s (cache hit)
- Cache TTL lej√°rat tesztel√©se
- API hiba eset√©n stale cache haszn√°lat

### **B. TELJES√çTM√âNY TESZTEK** ‚ö°

- Bet√∂lt√©si id≈ë m√©r√©se cache n√©lk√ºl vs cache-szel
- Mem√≥riahaszn√°lat monitoring
- API h√≠v√°sok sz√°m√°nak cs√∂kkent√©se
- Felhaszn√°l√≥i √©lm√©ny (UX) javul√°s

### **C. EDGE CASE TESZTEK** üß™

- √úres cache kezel√©se
- Nagy h√≠rt√∂megek (10k+ h√≠rek)
- T√∂bb orsz√°g p√°rhuzamos cache-el√©se
- Browser mem√≥ria korl√°tok

## üöÄ **V√ÅRT EREDM√âNYEK 30 NAP UT√ÅN**

| Metrika                       | Baseline | C√©l    | M√©r√©s             |
| ----------------------------- | -------- | ------ | ----------------- |
| **T√∂rzsm√≥d bet√∂lt√©s**         | 8-15s    | <500ms | **95% javul√°s**   |
| **Cache hit ar√°ny**           | 0%       | 70%+   | **√öj metrika**    |
| **API h√≠v√°sok**               | 100%     | 30%    | **70% cs√∂kken√©s** |
| **Felhaszn√°l√≥i el√©gedetts√©g** | Lass√∫    | Kiv√°l√≥ | **UX survey**     |

## üéâ **SIKERKRIT√âRIUMOK**

### **MINIMUM VIABLE CACHE (MVC)** ‚úÖ

- ‚úÖ T√∂rzsm√≥d cache hit >50%
- ‚úÖ Bet√∂lt√©si id≈ë <2s t√∂rzsm√≥dban
- ‚úÖ Zero breaking changes
- ‚úÖ Megb√≠zhat√≥ cache metrik√°k

### **OPTIMALIZED CACHE** üèÜ

- üéØ Cache hit >80%
- üéØ Bet√∂lt√©si id≈ë <500ms
- üéØ useTabStorage integr√°ci√≥
- üéØ Background refresh

**Ez a terv K√ñZVETLEN√úL a t√∂rzsm√≥d optimaliz√°l√°s√°ra f√≥kusz√°l √©s azonnali eredm√©nyeket fog hozni!** üöÄ
